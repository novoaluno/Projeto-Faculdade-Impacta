{% extends "base.html" %}

{% block content %}
    <h1>Adicionar Novo Pedido</h1>
    
    <form method="POST">
        <!-- SEÇÃO 1: Cliente -->
        <label for="cliente_id">Selecione o Cliente:</label>
        <select id="cliente_id" name="cliente_id" required>
            <option value="" disabled selected>-- Escolha um cliente --</option>
            {% for cliente in clientes %}
                <option value="{{ cliente._id }}">{{ cliente.nome }} ({{ cliente.email }})</option>
            {% endfor %}
        </select>

        <!-- SEÇÃO 2: Endereço de Entrega (NOVO) -->
        <h3 style="margin-top: 30px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Endereço de Entrega</h3>
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <div style="flex: 3;">
                <label for="logradouro">Rua/Logradouro:</label>
                <input type="text" id="logradouro" name="logradouro" required placeholder="Ex: Av. Paulista">
            </div>
            <div style="flex: 1;">
                <label for="numero">Número:</label>
                <input type="text" id="numero" name="numero" required placeholder="Ex: 100">
            </div>
        </div>
        
        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
            <div style="flex: 1;">
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro" name="bairro" required>
            </div>
            <div style="flex: 1;">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" name="cidade" required>
            </div>
        </div>

        <!-- SEÇÃO 3: Produtos -->
        <h3 style="margin-top: 30px; border-bottom: 1px solid #ddd; padding-bottom: 5px;">Selecionar Produtos</h3>
        
        {% if produtos %}
            <table>
                <thead>
                    <tr>
                        <th>Produto</th>
                        <th>Descrição</th>
                        <th>Preço Unit.</th>
                        <th>Estoque Atual</th>
                        <th>Quantidade</th>
                    </tr>
                </thead>
                <tbody>
                    {% for produto in produtos %}
                        <tr>
                            <input type="hidden" name="produto_id" value="{{ produto._id }}">
                            
                            <td>{{ produto.nome }}</td>
                            <td>{{ produto.descricao }}</td>
                            <td>R$ {{ produto.preco }}</td>
                            <td>{{ produto.quantidade }}</td>
                            <td>
                                <input type="number" 
                                       name="quantidade_{{ produto._id }}" 
                                       min="0" 
                                       max="{{ produto.quantidade }}" 
                                       value="0" 
                                       style="width: 70px;">
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>Nenhum produto com estoque disponível encontrado.</p>
        {% endif %}

        <br>
        <button type="submit" {% if not produtos %}disabled{% endif %} style="width: 100%; padding: 15px; font-size: 1.1em;">Finalizar Pedido</button>
    </form>
{% endblock %}